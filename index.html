<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM å°ˆæ¡ˆæˆ°æƒ…å®¤ - 2026 å°ˆæ¥­ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/dayjs@1/dayjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* åŸºç¤å­—é«”èˆ‡è¨­å®š */
        :root { --font-main: 'Helvetica Neue', Helvetica, Arial, 'Microsoft JhengHei', sans-serif; }
        [v-cloak] { display: none !important; }
        html { font-family: var(--font-main); font-size: 15px; }
        body { line-height: 1.6; overflow-y: scroll; }
        
        /* å‹•ç•«èˆ‡ç‰¹æ•ˆ */
        .transition-theme { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-lift { transition: transform 0.2s, box-shadow 0.2s; }
        .hover-lift:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1); }
        
        .diamond { transform: rotate(45deg); }
        
        /* ç‹€æ…‹ç‡ˆè™Ÿå‹•ç•« */
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(244, 63, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0); } }
        .status-blocked { animation: pulse-red 2s infinite; }

        /* åˆ—å°å„ªåŒ– */
        @media print {
            .no-print { display: none !important; }
            body, .print-card { background: white !important; color: black !important; box-shadow: none !important; border: none !important; }
            .print-area { width: 100% !important; margin: 0 !important; padding: 0 !important; }
            .page-break { page-break-before: always; }
        }

        /* å·è»¸ç¾åŒ– */
        ::-webkit-scrollbar { height: 8px; width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.5); border-radius: 4px; }
        
        /* Toast å‹•ç•« */
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px) translateX(-50%); } to { opacity: 1; transform: translateY(0) translateX(-50%); } }
        .animate-toast { animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body :class="[themeClasses.body, 'transition-theme min-h-screen pb-20']">
    <div id="app" v-cloak class="max-w-[1400px] mx-auto p-4 md:p-8">
        
        <!-- å…¨å±€é€šçŸ¥ Toast -->
        <div v-if="showToast" class="fixed bottom-8 left-1/2 z-50 bg-slate-800 text-white px-6 py-3 rounded-lg font-bold shadow-2xl flex items-center gap-3 animate-toast">
            <i class="fa-solid fa-circle-check text-emerald-400"></i>
            <span>{{ toastMessage }}</span>
        </div>

        <!-- é ‚éƒ¨ Header -->
        <header :class="[themeClasses.card, 'no-print flex flex-col md:flex-row justify-between items-center mb-6 p-6 rounded-2xl border shadow-sm transition-theme']">
            <div class="flex items-center gap-4 mb-4 md:mb-0">
                <div class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg shadow-indigo-500/30">
                    <i class="fa-solid fa-layer-group"></i>
                </div>
                <div>
                    <h1 :class="[themeClasses.brand, 'text-2xl font-black tracking-tight']">PM å°ˆæ¡ˆæˆ°æƒ…å®¤ <span class="text-xs align-top bg-slate-200 text-slate-600 px-1.5 py-0.5 rounded ml-1">v2026.PRO</span></h1>
                    <p class="text-sm opacity-50 font-bold">å°ˆæ¡ˆçµ„åˆç®¡ç†ç³»çµ± (PPM)</p>
                </div>
            </div>
            
            <div class="flex gap-3">
                <!-- ä¸»é¡Œåˆ‡æ› -->
                <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200 dark:bg-slate-800 dark:border-slate-700">
                    <button v-for="t in ['light','dark']" :key="t" @click="setTheme(t)" 
                            :class="[theme === t ? 'bg-white shadow text-indigo-600 dark:bg-slate-600 dark:text-white' : 'text-slate-400', 'w-8 h-8 rounded flex items-center justify-center transition-all']">
                        <i :class="['fa-solid', t==='light'?'fa-sun':'fa-moon']"></i>
                    </button>
                </div>
                <button @click="exportData" class="px-4 py-2 bg-slate-700 text-white rounded-lg text-sm font-bold hover:bg-slate-600 transition-all flex items-center gap-2">
                    <i class="fa-solid fa-download"></i> å‚™ä»½æ•¸æ“š
                </button>
                <label class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold hover:bg-indigo-500 transition-all cursor-pointer flex items-center gap-2 shadow-lg shadow-indigo-500/20">
                    <i class="fa-solid fa-upload"></i> åŒ¯å…¥å°ˆæ¡ˆ
                    <input type="file" @change="importData" class="hidden" accept=".json">
                </label>
            </div>
        </header>

        <!-- åˆ†é å°èˆª -->
        <nav class="no-print flex gap-2 mb-8 border-b border-slate-200 dark:border-slate-700 pb-1">
            <button v-for="tab in tabs" :key="tab.id"
                    @click="currentTab = tab.id" 
                    :class="['px-6 py-3 text-sm font-bold rounded-t-lg transition-all border-b-2', currentTab === tab.id ? 'border-indigo-500 text-indigo-600 bg-indigo-50/50 dark:bg-slate-800 dark:text-indigo-400' : 'border-transparent text-slate-400 hover:text-slate-600']">
                <i :class="['fa-solid mr-2', tab.icon]"></i>{{tab.n}}
            </button>
        </nav>

        <!-- TAB 1: å¹´åº¦ç”˜ç‰¹åœ– (Gantt) -->
        <main v-if="currentTab === 'time'" class="animate-fade-in">
            <section :class="[themeClasses.card, 'p-8 rounded-3xl shadow-xl border transition-theme overflow-hidden']">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="font-black text-xl flex items-center gap-2">
                        <i class="fa-solid fa-chart-gantt text-indigo-500"></i> 2026 å¹´åº¦å°ˆæ¡ˆå…¨è¦½
                    </h2>
                    <!-- åœ–ä¾‹ -->
                    <div class="flex gap-4 text-xs font-bold opacity-70">
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-emerald-500"></span> æ­£å¸¸ (On Track)</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-amber-500"></span> é¢¨éšª (Risk)</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-rose-500 animate-pulse"></span> å¡é—œ (Blocked)</span>
                    </div>
                </div>

                <div class="relative overflow-x-auto pb-4">
                    <div class="min-w-[1000px] xl:min-w-full relative">
                        <!-- æœˆä»½è»¸ -->
                        <div class="flex border-b border-slate-200 dark:border-slate-700 mb-6 text-xs font-bold opacity-40">
                            <div v-for="m in 12" :key="m" class="flex-1 text-center py-2">{{m}}æœˆ</div>
                        </div>
                        
                        <!-- å°ˆæ¡ˆåˆ— -->
                        <div v-if="projects.length === 0" class="text-center py-12 opacity-30 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-300">
                            æš«ç„¡å°ˆæ¡ˆè³‡æ–™ï¼Œè«‹è‡³ã€Œå°ˆæ¡ˆç®¡ç†ã€æ–°å¢
                        </div>

                        <div v-for="p in projects" :key="p.id" class="relative h-16 border-b border-slate-100 dark:border-slate-700/50 flex items-center group hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors px-2">
                            <!-- å°ˆæ¡ˆåç¨±æ¨™ç±¤ -->
                            <div class="absolute left-0 -top-2 z-20">
                                <span class="text-[10px] font-bold bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-slate-500">{{ p.name }}</span>
                            </div>
                            
                            <!-- èƒŒæ™¯è»Œé“ -->
                            <div class="w-full h-1 bg-slate-100 dark:bg-slate-700 rounded-full"></div>
                            
                            <!-- ä»»å‹™ç¯€é» (æ ¹æ“šç‹€æ…‹è®Šè‰²) -->
                            <div v-for="act in p.activities" :key="act.id" 
                                 class="absolute top-1/2 -translate-y-1/2 group/point" 
                                 :style="{ left: getYearPos(act.date) + '%' }">
                                
                                <div :class="['cursor-pointer transition-all hover:scale-150 z-10 relative border-2 shadow-sm', 
                                              act.type === 'deadline' ? 'w-4 h-4 diamond' : 'w-3 h-3 rounded-full',
                                              getStatusColorClass(act.status)]"
                                     :title="`${act.date} | ${act.name} (${statusText(act.status)})`">
                                     <!-- å¡é—œæ™‚é¡¯ç¤ºé©šå˜†è™Ÿ -->
                                     <i v-if="act.status === 'blocked'" class="fa-solid fa-exclamation text-white text-[8px] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 -rotate-45"></i>
                                </div>
                                
                                <!-- Tooltip -->
                                <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover/point:opacity-100 pointer-events-none transition-opacity z-30">
                                    {{ act.name }}
                                </div>
                            </div>
                        </div>

                        <!-- ä»Šæ—¥æŒ‡æ¨™ç·š -->
                        <div v-if="isCurrentYear" class="absolute top-0 bottom-0 w-px border-l-2 border-rose-500/30 border-dashed z-0 pointer-events-none" :style="{ left: getYearPos(today) + '%' }">
                            <div class="bg-rose-500 text-white text-[9px] px-1.5 py-0.5 rounded absolute -top-5 -left-4 font-bold whitespace-nowrap">ä»Šæ—¥ (TODAY)</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- TAB 2: å°ˆæ¡ˆç®¡ç† (æ ¸å¿ƒåŠŸèƒ½) -->
        <main v-if="currentTab === 'project'" class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- å·¦å´ï¼šå°ˆæ¡ˆåˆ—è¡¨ -->
            <aside class="lg:col-span-3 space-y-4">
                <button @click="addProject" class="w-full py-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-2xl text-slate-400 hover:text-indigo-500 hover:border-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-all font-bold text-sm flex items-center justify-center gap-2">
                    <i class="fa-solid fa-plus"></i> å»ºç«‹æ–°å°ˆæ¡ˆ
                </button>
                
                <div class="space-y-3 max-h-[calc(100vh-200px)] overflow-y-auto pr-1">
                    <div v-for="p in projects" :key="p.id" @click="selectedPid = p.id" 
                         :class="['p-4 rounded-2xl cursor-pointer transition-all border-l-4 group relative overflow-hidden shadow-sm', selectedPid === p.id ? themeClasses.activeItem : themeClasses.inactiveItem]">
                        <div class="flex justify-between items-start mb-2 relative z-10">
                            <div class="font-bold truncate pr-2 text-sm">{{ p.name }}</div>
                            <div class="text-[10px] font-black px-1.5 py-0.5 rounded bg-black/10">{{ calculateProgress(p) }}%</div>
                        </div>
                        <div class="flex gap-2 text-[10px] opacity-60 relative z-10 font-bold uppercase">
                            <span v-if="getRiskCount(p).blocked > 0" class="text-rose-500"><i class="fa-solid fa-ban mr-1"></i>{{ getRiskCount(p).blocked }} å¡é—œ</span>
                            <span v-if="getRiskCount(p).highRisk > 0" class="text-amber-500"><i class="fa-solid fa-triangle-exclamation mr-1"></i>é¢¨éšª</span>
                        </div>
                        <!-- èƒŒæ™¯é€²åº¦æ¢ -->
                        <div class="absolute bottom-0 left-0 h-1 bg-indigo-500/20 transition-all duration-500" :style="{ width: calculateProgress(p) + '%' }"></div>
                    </div>
                </div>
            </aside>

            <!-- å³å´ï¼šç·¨è¼¯å€åŸŸ -->
            <article v-if="activeProject" :class="[themeClasses.card, 'lg:col-span-9 p-6 md:p-10 rounded-3xl shadow-xl border transition-theme relative']">
                <!-- æ¨™é¡Œåˆ— -->
                <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-8 pb-6 border-b border-slate-100 dark:border-slate-700">
                    <div class="w-full">
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">å°ˆæ¡ˆåç¨± (Project Name)</label>
                        <input v-model="activeProject.name" class="text-3xl font-black bg-transparent outline-none w-full placeholder-slate-300 dark:placeholder-slate-600" placeholder="è¼¸å…¥å°ˆæ¡ˆåç¨±...">
                    </div>
                    <div class="flex items-center gap-3 shrink-0">
                        <button @click="deleteProject" class="text-rose-500 hover:bg-rose-50 px-3 py-2 rounded-lg text-xs font-bold transition-all"><i class="fa-solid fa-trash-can mr-1"></i> åˆªé™¤å°ˆæ¡ˆ</button>
                    </div>
                </div>

                <!-- è³‡è¨Šçœ‹æ¿ (Stakeholders & Risks) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                    <!-- å·¦ï¼šå°ˆæ¡ˆåˆ©å®³é—œä¿‚äºº -->
                    <div :class="[themeClasses.innerCard, 'p-5 rounded-2xl border shadow-sm']">
                        <h3 class="text-xs font-black opacity-50 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-users text-indigo-500"></i> åˆ©å®³é—œä¿‚äºº / çª—å£ (Stakeholders)
                        </h3>
                        <div class="mb-3">
                            <input v-model="activeProject.org" placeholder="å®¢æˆ¶ / å–®ä½åç¨±" class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded px-3 py-2 text-sm font-bold outline-none focus:border-indigo-500">
                        </div>
                        <div class="space-y-2 max-h-40 overflow-y-auto custom-scroll pr-1">
                            <div v-for="(contact, cIdx) in activeProject.contacts" :key="cIdx" class="flex gap-2">
                                <input v-model="contact.name" placeholder="å§“å/è·ç¨±" class="w-1/3 bg-transparent border-b border-slate-200 focus:border-indigo-500 text-xs py-1 outline-none">
                                <input v-model="contact.info" placeholder="è¯çµ¡è³‡è¨Š" class="flex-1 bg-transparent border-b border-slate-200 focus:border-indigo-500 text-xs py-1 outline-none">
                                <button @click="removeContact(cIdx)" class="text-slate-300 hover:text-rose-500"><i class="fa-solid fa-xmark"></i></button>
                            </div>
                        </div>
                        <button @click="addContact" class="text-indigo-500 font-bold text-xs mt-3 hover:underline">+ æ–°å¢é—œä¿‚äºº</button>
                    </div>

                    <!-- å³ï¼šé¢¨éšªèˆ‡è­°é¡Œæ—¥èªŒ (Risk Log) -->
                    <div :class="[themeClasses.innerCard, 'p-5 rounded-2xl border shadow-sm bg-rose-50/30 dark:bg-rose-900/10 border-rose-100 dark:border-rose-900/30']">
                        <h3 class="text-xs font-black opacity-50 uppercase tracking-widest mb-4 flex items-center gap-2 text-rose-600">
                            <i class="fa-solid fa-fire-extinguisher"></i> é¢¨éšªèˆ‡è­°é¡Œæ—¥èªŒ (Risks & Issues)
                        </h3>
                        <div class="space-y-3 max-h-40 overflow-y-auto custom-scroll pr-1">
                            <div v-for="(risk, rIdx) in activeProject.risks" :key="rIdx" class="bg-white dark:bg-slate-800 p-3 rounded-xl border border-rose-100 dark:border-rose-900/50 shadow-sm group">
                                <div class="flex justify-between items-center mb-1">
                                    <select v-model="risk.level" :class="getRiskLevelClass(risk.level)" class="text-[10px] font-black uppercase px-2 py-0.5 rounded outline-none cursor-pointer border-none">
                                        <option value="high">é«˜ (High)</option>
                                        <option value="med">ä¸­ (Med)</option>
                                        <option value="low">ä½ (Low)</option>
                                    </select>
                                    <button @click="removeRisk(rIdx)" class="text-slate-300 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fa-solid fa-xmark"></i></button>
                                </div>
                                <input v-model="risk.desc" placeholder="æè¿°é¢¨éšªå…§å®¹..." class="w-full bg-transparent text-xs font-bold outline-none mb-1">
                                <input v-model="risk.action" placeholder="â†’ ç·©è§£å°ç­– (Mitigation)" class="w-full bg-transparent text-[10px] text-slate-500 outline-none">
                            </div>
                        </div>
                        <button @click="addRisk" class="text-rose-500 font-bold text-xs mt-3 hover:underline">+ æ–°å¢é¢¨éšªé …ç›®</button>
                    </div>
                </div>

                <!-- ä»»å‹™æ’ç¨‹èˆ‡ç‹€æ…‹ç®¡ç† -->
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-black text-lg text-slate-700 dark:text-slate-200">å°ˆæ¡ˆé‡Œç¨‹ç¢‘ & ä»»å‹™ç‹€æ…‹</h3>
                    <button @click="addActivity" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-500 shadow-lg shadow-indigo-500/20 font-bold transition-all text-xs flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> æ–°å¢ä»»å‹™
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div v-if="activeProject.activities.length === 0" class="text-center py-10 opacity-40 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl">
                        å°šç„¡æ’ç¨‹ï¼Œè«‹é»æ“Šå³ä¸Šæ–¹æŒ‰éˆ•æ–°å¢
                    </div>

                    <div v-for="(act, idx) in sortedActivities" :key="act.id" 
                         :class="[themeClasses.innerCard, 'p-4 rounded-2xl border transition-all hover:shadow-md group relative overflow-visible flex flex-col xl:flex-row gap-4 items-start xl:items-center']">
                        
                        <!-- 1. ç‹€æ…‹æ§åˆ¶ (Status) - PM æ ¸å¿ƒ -->
                        <div class="relative group/status shrink-0">
                            <button :class="['w-32 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all border flex items-center justify-center gap-2', getStatusBtnClass(act.status)]">
                                <i :class="statusIcon(act.status)"></i> {{ statusText(act.status) }}
                            </button>
                            <!-- ä¸‹æ‹‰é¸å–® -->
                            <div class="absolute top-full left-0 w-36 bg-white dark:bg-slate-800 shadow-xl rounded-xl overflow-hidden hidden group-hover/status:block z-50 border border-slate-100 dark:border-slate-600 mt-1">
                                <div v-for="s in ['pending','ontrack','risk','blocked','done']" :key="s"
                                     @click="act.status = s"
                                     class="px-3 py-2 text-xs font-bold hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer flex items-center gap-2 text-slate-600 dark:text-slate-300">
                                     <div :class="['w-2 h-2 rounded-full', getStatusDot(s)]"></div> {{ statusText(s) }}
                                </div>
                            </div>
                        </div>

                        <!-- 2. æ—¥æœŸèˆ‡é¡å‹ -->
                        <div class="flex gap-2 shrink-0">
                            <input type="date" v-model="act.date" class="bg-slate-100 dark:bg-slate-900 border border-transparent focus:border-indigo-500 rounded px-2 py-1.5 text-xs font-bold outline-none text-slate-600 dark:text-slate-300">
                            <select v-model="act.type" class="bg-slate-100 dark:bg-slate-900 rounded px-2 py-1.5 text-xs font-bold outline-none cursor-pointer border border-transparent focus:border-indigo-500 text-slate-600 dark:text-slate-300">
                                <option value="activity">ä¸€èˆ¬ä»»å‹™</option>
                                <option value="deadline">ğŸš© é‡Œç¨‹ç¢‘</option>
                            </select>
                        </div>

                        <!-- 3. è² è²¬äºº (Owner) -->
                        <div class="shrink-0 relative">
                            <i class="fa-solid fa-user text-slate-300 absolute left-2 top-1/2 -translate-y-1/2 text-[10px]"></i>
                            <input v-model="act.owner" placeholder="è² è²¬äºº" class="w-24 pl-6 pr-2 py-1.5 bg-transparent border-b border-slate-200 focus:border-indigo-500 text-xs font-bold outline-none placeholder-slate-300 text-center">
                        </div>

                        <!-- 4. ä»»å‹™åç¨± -->
                        <div class="flex-1 w-full">
                            <input v-model="act.name" placeholder="è¼¸å…¥ä»»å‹™æˆ–é‡Œç¨‹ç¢‘åç¨±" :class="[act.status === 'done' ? 'line-through opacity-50' : '', 'w-full bg-transparent text-sm font-bold outline-none border-b border-transparent focus:border-indigo-500 transition-all']">
                        </div>

                        <!-- 5. æ“ä½œå€ -->
                        <div class="flex items-center gap-3 shrink-0 ml-auto xl:ml-0">
                            <button @click="act.showNote = !act.showNote" :class="[act.note ? 'text-amber-500' : 'text-slate-300 hover:text-slate-500']">
                                <i class="fa-solid fa-note-sticky"></i>
                            </button>
                            <button @click="removeActivity(idx)" class="text-slate-300 hover:text-rose-500 w-6 h-6 flex items-center justify-center rounded hover:bg-rose-50 transition-colors">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>

                        <!-- ç­†è¨˜å±•é–‹ -->
                        <div v-if="act.showNote" class="w-full mt-2 pt-2 border-t border-slate-100 dark:border-slate-700/50">
                            <textarea v-model="act.note" class="w-full h-20 bg-slate-50 dark:bg-slate-900 rounded-lg p-3 text-xs outline-none border border-slate-200 dark:border-slate-700 resize-none focus:ring-1 focus:ring-indigo-500" placeholder="è©³ç´°å‚™è¨» / äº¤ä»˜ç‰©èªªæ˜..."></textarea>
                        </div>
                    </div>
                </div>
            </article>

            <!-- ç„¡é¸æ“‡æ™‚çš„æç¤º -->
            <div v-else class="lg:col-span-9 flex flex-col items-center justify-center text-center opacity-30 h-[600px] border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-3xl">
                <i class="fa-solid fa-folder-open text-6xl mb-4 text-slate-400"></i>
                <p class="text-xl font-bold">è«‹å¾å·¦å´é¸æ“‡å°ˆæ¡ˆé€²è¡Œç®¡ç†</p>
            </div>
        </main>

        <!-- TAB 3: æˆ°æƒ…å„€è¡¨æ¿èˆ‡å ±å‘Š (Dashboard) -->
        <main v-if="currentTab === 'report'" class="animate-fade-in">
            <div v-if="!activeProject" class="text-center p-20 opacity-30 font-bold text-2xl">è«‹å…ˆé¸æ“‡ä¸€å€‹å°ˆæ¡ˆ</div>
            <article v-else :class="[themeClasses.card, 'p-8 md:p-12 rounded-3xl shadow-xl border print-area']">
                
                <!-- å ±å‘Š Header -->
                <div class="flex justify-between items-start mb-10 pb-6 border-b-4 border-slate-100 dark:border-slate-700">
                    <div>
                        <h2 class="text-4xl font-black mb-2">{{ activeProject.name }}</h2>
                        <div class="text-sm opacity-60 font-bold uppercase tracking-wide">
                            {{ activeProject.org || 'æœªè¨­å®šå–®ä½' }} | 2026 å°ˆæ¡ˆåŸ·è¡Œå ±å‘Š
                        </div>
                    </div>
                    <button @click="window.print()" class="no-print px-6 py-3 bg-slate-800 text-white rounded-xl font-bold shadow hover:bg-slate-700 transition-all text-sm">
                        <i class="fa-solid fa-print mr-2"></i> åˆ—å°å ±å‘Š
                    </button>
                </div>

                <!-- æˆ°æƒ…å„€è¡¨æ¿ (Dashboard) -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
                    <div class="bg-slate-50 dark:bg-slate-800 p-5 rounded-2xl border border-slate-100 dark:border-slate-700 text-center">
                        <div class="text-[10px] font-black uppercase text-slate-400 tracking-wider mb-1">ç¸½é«”é€²åº¦</div>
                        <div class="text-3xl font-black text-indigo-600">{{ calculateProgress(activeProject) }}<span class="text-sm align-top">%</span></div>
                    </div>
                    <div class="bg-rose-50 dark:bg-rose-900/10 p-5 rounded-2xl border border-rose-100 dark:border-rose-900/30 text-center">
                        <div class="text-[10px] font-black uppercase text-rose-400 tracking-wider mb-1">å¡é—œé …ç›® (Blocked)</div>
                        <div class="text-3xl font-black text-rose-500">{{ activeProject.activities.filter(a => a.status === 'blocked').length }}</div>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-800 p-5 rounded-2xl border border-slate-100 dark:border-slate-700 text-center">
                        <div class="text-[10px] font-black uppercase text-slate-400 tracking-wider mb-1">å¾…è¾¦ / é€²è¡Œä¸­</div>
                        <div class="text-3xl font-black text-slate-700 dark:text-slate-200">{{ activeProject.activities.filter(a => ['pending','ontrack','risk'].includes(a.status)).length }}</div>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-800 p-5 rounded-2xl border border-slate-100 dark:border-slate-700 text-center relative overflow-hidden">
                        <div class="text-[10px] font-black uppercase text-slate-400 tracking-wider mb-1">å°ˆæ¡ˆé¢¨éšªæŒ‡æ•¸</div>
                        <div :class="['text-3xl font-black', getRiskLevelColor(getRiskScore(activeProject))]">
                            {{ getRiskScore(activeProject) }}
                        </div>
                        <div :class="['absolute bottom-0 left-0 h-1 w-full', getRiskLevelColorBg(getRiskScore(activeProject))]"></div>
                    </div>
                </div>

                <!-- é¢¨éšªæ‘˜è¦ -->
                <div v-if="activeProject.risks.length > 0" class="mb-10 p-6 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-dashed border-slate-300 dark:border-slate-700">
                    <h4 class="text-xs font-black uppercase text-slate-400 mb-4">é‡é»é¢¨éšªé—œæ³¨ (Top Risks)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div v-for="risk in activeProject.risks" class="flex gap-3 items-start">
                            <span :class="['px-2 py-0.5 rounded text-[10px] font-black uppercase shrink-0 mt-0.5', getRiskLevelClass(risk.level)]">{{ getRiskLevelText(risk.level) }}</span>
                            <div>
                                <div class="text-sm font-bold leading-tight">{{ risk.desc }}</div>
                                <div class="text-xs text-slate-500 mt-1" v-if="risk.action">ğŸ‘‰ {{ risk.action }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åŸ·è¡Œæ˜ç´° -->
                <div class="space-y-8">
                    <h4 class="text-xs font-black opacity-40 uppercase border-b border-slate-200 dark:border-slate-700 pb-2">åŸ·è¡Œæ˜ç´° (Timeline)</h4>
                    <div v-for="month in 12" :key="month" class="flex gap-6 break-inside-avoid">
                        <div class="w-12 text-center shrink-0 pt-1">
                            <div class="text-2xl font-black opacity-20">{{ month }}<span class="text-xs ml-0.5">æœˆ</span></div>
                        </div>
                        <div class="flex-1 border-l-2 border-slate-100 dark:border-slate-700 pl-6 space-y-4 pb-6">
                            <div v-if="getActivitiesByMonth(month).length === 0" class="text-xs italic opacity-20 py-2">ç„¡æ’ç¨‹</div>
                            
                            <div v-for="act in getActivitiesByMonth(month)" :key="act.id" 
                                 class="flex items-start gap-4 p-4 rounded-xl border border-slate-100 dark:border-slate-700 bg-white dark:bg-slate-800/30">
                                
                                <div class="shrink-0 mt-1">
                                    <div :class="['w-2 h-2 rounded-full', getStatusDot(act.status)]"></div>
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <div :class="['font-bold text-base', act.status === 'done' ? 'line-through opacity-40' : '']">{{ act.name }}</div>
                                        <div class="text-[10px] font-black bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-slate-500">{{ dayjs(act.date).format('MM/DD') }}</div>
                                    </div>
                                    <div class="flex gap-4 mt-1 text-xs text-slate-500">
                                        <span v-if="act.owner" class="flex items-center gap-1"><i class="fa-solid fa-user text-[10px]"></i> {{ act.owner }}</span>
                                        <span :class="['font-bold uppercase text-[10px]', getStatusTextColor(act.status)]">{{ statusText(act.status) }}</span>
                                    </div>
                                    <div v-if="act.note" class="mt-2 text-xs opacity-70 border-l-2 border-slate-200 pl-2">{{ act.note }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        </main>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    theme: localStorage.getItem('pm-theme') || 'light',
                    currentTab: 'time',
                    selectedPid: null,
                    showToast: false,
                    toastMessage: '',
                    projects: JSON.parse(localStorage.getItem('pm-dashboard-v2026')) || [],
                    tabs: [
                        {id:'time',n:'å¹´åº¦å…¨è¦½',icon:'fa-calendar-days'},
                        {id:'project',n:'å°ˆæ¡ˆç®¡ç†',icon:'fa-list-check'},
                        {id:'report',n:'å ±å‘Š & å„€è¡¨æ¿',icon:'fa-chart-pie'}
                    ]
                }
            },
            computed: {
                activeProject() { 
                    if (!this.projects.length) return null;
                    return this.projects.find(p => p.id === this.selectedPid) || this.projects[0]; 
                },
                sortedActivities() { 
                    return this.activeProject?.activities.sort((a,b) => dayjs(a.date).diff(dayjs(b.date))) || []; 
                },
                today() { return dayjs().format('YYYY-MM-DD'); },
                isCurrentYear() { return dayjs().year() === 2026; },
                themeClasses() {
                    const isDark = this.theme === 'dark';
                    return {
                        body: isDark ? 'bg-[#0f172a] text-slate-300' : 'bg-slate-50 text-slate-700',
                        card: isDark ? 'bg-[#1e293b] border-slate-700' : 'bg-white border-slate-200',
                        brand: isDark ? 'text-white' : 'text-slate-800',
                        innerCard: isDark ? 'bg-[#0f172a] border-slate-700' : 'bg-slate-50 border-slate-100',
                        inputField: isDark ? 'bg-[#0f172a] border-slate-600 text-slate-200' : 'bg-white border-slate-200 text-slate-700',
                        activeItem: isDark ? 'bg-indigo-900/30 border-indigo-500 text-indigo-200' : 'bg-white border-indigo-500 text-indigo-700 shadow-md',
                        inactiveItem: isDark ? 'border-transparent opacity-60 hover:bg-slate-800' : 'border-transparent opacity-60 hover:bg-white hover:shadow-sm'
                    };
                }
            },
            watch: {
                projects: { 
                    handler(val) { localStorage.setItem('pm-dashboard-v2026', JSON.stringify(val)); }, 
                    deep: true 
                }
            },
            methods: {
                dayjs,
                setTheme(t) { this.theme = t; localStorage.setItem('pm-theme', t); },
                
                // --- ç‹€æ…‹èˆ‡æ¨£å¼é‚è¼¯ ---
                statusText(s) { const map = { pending:'å¾…è¾¦', ontrack:'æ­£å¸¸', risk:'é¢¨éšª', blocked:'å¡é—œ', done:'å®Œæˆ' }; return map[s] || 'å¾…è¾¦'; },
                statusIcon(s) { const map = { pending:'fa-regular fa-circle', ontrack:'fa-solid fa-play', risk:'fa-solid fa-triangle-exclamation', blocked:'fa-solid fa-ban', done:'fa-solid fa-check' }; return map[s]; },
                
                getStatusBtnClass(s) {
                    const map = {
                        pending: 'border-slate-300 text-slate-500 bg-slate-50 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-400',
                        ontrack: 'border-emerald-500 text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 dark:text-emerald-400',
                        risk: 'border-amber-500 text-amber-600 bg-amber-50 dark:bg-amber-900/20 dark:text-amber-400',
                        blocked: 'border-rose-500 text-rose-600 bg-rose-50 dark:bg-rose-900/20 dark:text-rose-400 status-blocked',
                        done: 'border-slate-500 text-slate-600 bg-slate-100 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-300'
                    };
                    return map[s];
                },
                getStatusColorClass(s) {
                    const map = {
                        pending: 'bg-slate-300 border-slate-400',
                        ontrack: 'bg-emerald-500 border-emerald-600',
                        risk: 'bg-amber-400 border-amber-500',
                        blocked: 'bg-rose-500 border-rose-600 status-blocked',
                        done: 'bg-slate-300 border-slate-400 grayscale opacity-50'
                    };
                    return map[s] || map.pending;
                },
                getStatusDot(s) {
                    const map = { pending: 'bg-slate-300', ontrack: 'bg-emerald-500', risk: 'bg-amber-500', blocked: 'bg-rose-500', done: 'bg-slate-700' };
                    return map[s];
                },
                getStatusTextColor(s) {
                    const map = { pending: 'text-slate-400', ontrack: 'text-emerald-600', risk: 'text-amber-600', blocked: 'text-rose-600', done: 'text-slate-400' };
                    return map[s];
                },
                getRiskLevelClass(l) {
                    const map = { high: 'bg-rose-100 text-rose-600', med: 'bg-amber-100 text-amber-600', low: 'bg-slate-200 text-slate-600' };
                    return map[l];
                },
                getRiskLevelText(l) {
                    const map = { high: 'é«˜é¢¨éšª', med: 'ä¸­é¢¨éšª', low: 'ä½é¢¨éšª' };
                    return map[l] || l;
                },

                // --- æ•¸æ“šé‚è¼¯ ---
                getYearPos(date) { 
                    const start = dayjs('2026-01-01');
                    let percent = (dayjs(date).diff(start, 'day') / 365) * 100;
                    return Math.max(0, Math.min(100, percent));
                },
                calculateProgress(p) { 
                    if (!p || !p.activities.length) return 0; 
                    const completed = p.activities.filter(a => a.status === 'done').length;
                    return Math.round((completed / p.activities.length) * 100); 
                },
                getRiskCount(p) {
                    return {
                        blocked: p.activities.filter(a => a.status === 'blocked').length,
                        highRisk: p.risks.filter(r => r.level === 'high').length
                    };
                },
                getRiskScore(p) {
                    const blocked = p.activities.filter(a => a.status === 'blocked').length;
                    const highRisks = p.risks.filter(r => r.level === 'high').length;
                    const medRisks = p.risks.filter(r => r.level === 'med').length;
                    
                    if (blocked > 0 || highRisks > 0) return 'HIGH';
                    if (medRisks > 1) return 'MED';
                    return 'LOW';
                },
                getRiskLevelColor(level) { return { HIGH: 'text-rose-500', MED: 'text-amber-500', LOW: 'text-emerald-500' }[level]; },
                getRiskLevelColorBg(level) { return { HIGH: 'bg-rose-500', MED: 'bg-amber-500', LOW: 'bg-emerald-500' }[level]; },
                getActivitiesByMonth(m) { if (!this.activeProject) return []; return this.activeProject.activities.filter(a => dayjs(a.date).month() + 1 === m).sort((a,b) => dayjs(a.date).diff(dayjs(b.date))); },
                
                // --- CRUD æ“ä½œ ---
                addProject() { 
                    const id = Date.now(); 
                    this.projects.unshift({ id, name: 'æ–°å°ˆæ¡ˆ Project', org: '', contacts: [], risks: [], activities: [] }); 
                    this.selectedPid = id; 
                },
                deleteProject() { 
                    if (confirm('âš ï¸ ç¢ºå®šåˆªé™¤æ­¤å°ˆæ¡ˆï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) { 
                        this.projects = this.projects.filter(p => p.id !== this.selectedPid); 
                        this.selectedPid = this.projects.length ? this.projects[0].id : null; 
                    } 
                },
                addActivity() { 
                    this.activeProject.activities.push({ 
                        id: Date.now(), 
                        name: '', 
                        date: dayjs().year(2026).format('YYYY-MM-DD'),
                        status: 'pending',
                        owner: '',
                        type: 'activity', 
                        note: '', 
                        showNote: false 
                    }); 
                },
                removeActivity(idx) { this.activeProject.activities.splice(idx, 1); },
                addContact() { this.activeProject.contacts.push({ name: '', info: '' }); },
                removeContact(i) { this.activeProject.contacts.splice(i, 1); },
                addRisk() { if(!this.activeProject.risks) this.activeProject.risks=[]; this.activeProject.risks.push({ level: 'med', desc: '', action: '' }); },
                removeRisk(i) { this.activeProject.risks.splice(i, 1); },
                
                // --- I/O ---
                exportData() { 
                    const link = document.createElement('a'); 
                    link.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(this.projects)); 
                    link.download = `PM_Backup_${dayjs().format('YYYYMMDD')}.json`; 
                    link.click(); 
                    this.showToastMsg('å‚™ä»½å·²ä¸‹è¼‰');
                },
                importData(event) { 
                    const reader = new FileReader(); 
                    reader.onload = (e) => { 
                        try {
                            this.projects = JSON.parse(e.target.result);
                            if(this.projects.length) this.selectedPid = this.projects[0].id;
                            this.showToastMsg('è³‡æ–™åŒ¯å…¥æˆåŠŸ');
                        } catch(err) { alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤'); }
                        event.target.value = '';
                    }; 
                    reader.readAsText(event.target.files[0]); 
                },
                showToastMsg(msg) {
                    this.toastMessage = msg; this.showToast = true;
                    setTimeout(() => this.showToast = false, 2500);
                }
            },
            mounted() { 
                if(this.projects.length) this.selectedPid = this.projects[0].id; 
            }
        }).mount('#app')
    </script>
</body>
</html>
