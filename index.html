<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Personal Timeline Manager</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/dayjs@1/dayjs.min.js"></script>
    <style>
        .timeline-grid {
            background-image: linear-gradient(to right, #e5e7eb 1px, transparent 1px);
            background-size: 8.333% 100%; /* 12å€‹æœˆæ ¼ç·š */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="app" class="p-4 md:p-8">
        <header class="mb-8 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-600">ğŸ“… 2026 å¹´åº¦è¨ˆç•«è§€æ¸¬ç«™</h1>
            <div class="space-x-2">
                <button @click="addProject" class="bg-indigo-500 text-white px-4 py-2 rounded shadow hover:bg-indigo-600 transition">æ–°å¢è¨ˆç•«</button>
                <button @click="exportData" class="border border-gray-300 px-4 py-2 rounded bg-white">åŒ¯å‡º JSON</button>
            </div>
        </header>

        <div class="relative mb-2 ml-48 flex border-b border-gray-200 text-sm text-gray-400">
            <div v-for="m in 12" :key="m" class="flex-1 text-center">{{ m }}æœˆ</div>
        </div>

        <div class="relative border border-gray-200 rounded-lg bg-white shadow-sm overflow-hidden">
            <div class="timeline-grid absolute inset-0 ml-48 pointer-events-none"></div>
            
            <div v-for="(project, pIdx) in projects" :key="project.id" 
                 class="relative flex items-center h-16 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition">
                
                <div class="w-48 px-4 flex-shrink-0 font-medium truncate">
                    <input v-model="project.name" class="bg-transparent focus:ring-1 ring-indigo-300 rounded px-1 w-full outline-none">
                </div>

                <div class="flex-grow h-full relative">
                    <div v-if="isCurrentYear" class="absolute h-full w-px bg-red-400 z-10" :style="{ left: todayPosition + '%' }"></div>
                    
                    <div v-for="(ms, mIdx) in project.milestones" :key="mIdx"
                         class="absolute top-1/2 -translate-y-1/2 group"
                         :style="{ left: getPosition(ms.date) + '%' }">
                        <div class="w-4 h-4 rounded-full border-2 border-white shadow-sm cursor-pointer hover:scale-125 transition"
                             :class="ms.type === 'end' ? 'bg-red-500' : 'bg-indigo-500'"
                             @click="editMilestone(pIdx, mIdx)"></div>
                        <div class="hidden group-hover:block absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-20">
                            {{ ms.name }} ({{ ms.date }})
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <p class="mt-6 text-sm text-gray-500 italic">* æç¤ºï¼šæ‰€æœ‰è³‡æ–™å‡å„²å­˜æ–¼æ‚¨çš„ç€è¦½å™¨å¿«å– (Local Storage)ã€‚</p>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    projects: JSON.parse(localStorage.getItem('my-projects')) || [
                        { id: 1, name: 'æ–°ç”¢å“é–‹ç™¼æ¡ˆ', milestones: [
                            { name: 'Kickoff', date: '2026-01-10', type: 'start' },
                            { name: 'Beta ç‰ˆ', date: '2026-05-15', type: 'checkpoint' },
                            { name: 'æ­£å¼ä¸Šç·š', date: '2026-10-01', type: 'end' }
                        ]},
                        { id: 2, name: 'å€‹äººé€²ä¿®è¨ˆç•«', milestones: [
                            { name: 'å ±å', date: '2026-02-01', type: 'start' },
                            { name: 'è­‰ç…§è€ƒè©¦', date: '2026-07-20', type: 'checkpoint' }
                        ]}
                    ]
                }
            },
            computed: {
                todayPosition() {
                    return this.getPosition(dayjs().format('YYYY-MM-DD'));
                },
                isCurrentYear() {
                    return dayjs().year() === 2026;
                }
            },
            watch: {
                projects: {
                    handler(newVal) {
                        localStorage.setItem('my-projects', JSON.stringify(newVal));
                    },
                    deep: true
                }
            },
            methods: {
                getPosition(date) {
                    const startOfYear = dayjs('2026-01-01');
                    const endOfYear = dayjs('2026-12-31');
                    const totalDays = endOfYear.diff(startOfYear, 'day');
                    const currentDays = dayjs(date).diff(startOfYear, 'day');
                    return (currentDays / totalDays) * 100;
                },
                addProject() {
                    const name = prompt('è«‹è¼¸å…¥è¨ˆç•«åç¨±:');
                    if (name) {
                        this.projects.push({
                            id: Date.now(),
                            name,
                            milestones: [{ name: 'é–‹å§‹', date: '2026-01-01', type: 'start' }]
                        });
                    }
                },
                editMilestone(pIdx, mIdx) {
                    const ms = this.projects[pIdx].milestones[mIdx];
                    const newName = prompt('ä¿®æ”¹æ§åˆ¶é»åç¨±:', ms.name);
                    const newDate = prompt('ä¿®æ”¹æ—¥æœŸ (YYYY-MM-DD):', ms.date);
                    if (newName && newDate) {
                        ms.name = newName;
                        ms.date = newDate;
                    }
                },
                exportData() {
                    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(this.projects));
                    const downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href",     dataStr);
                    downloadAnchorNode.setAttribute("download", "projects_backup.json");
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
