<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Project Timeline</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/dayjs@1/dayjs.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="app" class="max-w-6xl mx-auto p-6">
        <nav class="flex space-x-4 mb-6 border-b border-gray-200">
            <button @click="currentTab = 'time'" :class="tabClass(currentTab === 'time')">時間軸總覽</button>
            <button @click="currentTab = 'project'" :class="tabClass(currentTab === 'project')">計畫詳情</button>
        </nav>

        <div v-if="currentTab === 'time'" class="space-y-8">
            <section class="bg-white p-4 rounded-xl shadow">
                <h2 class="font-bold mb-4">2026 年度觀測</h2>
                <div class="h-40 relative border-t border-gray-100">
                    <div v-for="p in projects" :key="p.id" class="h-8 flex items-center relative border-b border-gray-50">
                        <div v-for="act in p.activities" 
                             class="absolute w-3 h-3 rounded-full bg-blue-500"
                             :title="p.name + ': ' + act.name"
                             :style="{ left: getYearPos(act.date) + '%' }"></div>
                    </div>
                </div>
            </section>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-4 rounded-xl shadow">
                    <h2 class="font-bold mb-4">本月活動 ({{ currentMonth }}月)</h2>
                    <ul class="divide-y">
                        <li v-for="item in monthActivities" class="py-2 flex justify-between">
                            <span><b class="text-blue-600">{{ item.pName }}</b>: {{ item.name }}</span>
                            <span class="text-gray-400 text-sm">{{ item.date }}</span>
                        </li>
                    </ul>
                </div>
                <div class="bg-white p-4 rounded-xl shadow border-l-4 border-orange-400">
                    <h2 class="font-bold mb-4">本週焦點</h2>
                    <ul class="divide-y">
                        <li v-for="item in weekActivities" class="py-2">
                            <span class="bg-orange-100 text-orange-700 text-xs px-2 py-1 rounded mr-2">Day {{ dayjs(item.date).format('dd') }}</span>
                            <span>{{ item.pName }} - {{ item.name }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'project'" class="flex gap-6">
            <div class="w-1/3 bg-white p-4 rounded-xl shadow h-fit">
                <h2 class="font-bold mb-4">計畫列表</h2>
                <div v-for="p in projects" @click="selectedPid = p.id" 
                     :class="['p-3 mb-2 rounded cursor-pointer transition', selectedPid === p.id ? 'bg-indigo-500 text-white' : 'bg-gray-50 hover:bg-gray-100']">
                    {{ p.name }}
                </div>
                <button @click="addProject" class="w-full mt-4 border-2 border-dashed py-2 rounded text-gray-400 hover:text-indigo-500">+ 新增計畫</button>
            </div>

            <div v-if="activeProject" class="flex-1 bg-white p-6 rounded-xl shadow">
                <div class="flex justify-between items-start mb-6">
                    <input v-model="activeProject.name" class="text-2xl font-bold outline-none border-b border-transparent focus:border-gray-300">
                    <button @click="deleteProject" class="text-red-400 text-sm">刪除計畫</button>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-8 p-4 bg-gray-50 rounded-lg">
                    <div>
                        <label class="block text-xs text-gray-400">聯絡人</label>
                        <input v-model="activeProject.contact.name" class="bg-transparent w-full">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400">聯繫方式</label>
                        <input v-model="activeProject.contact.info" class="bg-transparent w-full">
                    </div>
                </div>

                <h3 class="font-bold mb-3">活動清單 (Activities)</h3>
                <table class="w-full text-left mb-4">
                    <thead><tr class="text-sm text-gray-400"><th>日期</th><th>名稱</th><th></th></tr></thead>
                    <tbody>
                        <tr v-for="(act, idx) in activeProject.activities" class="border-b border-gray-50">
                            <td class="py-2"><input type="date" v-model="act.date" class="text-sm"></td>
                            <td><input v-model="act.name" class="w-full"></td>
                            <td class="text-right"><button @click="activeProject.activities.splice(idx,1)" class="text-gray-300">✕</button></td>
                        </tr>
                    </tbody>
                </table>
                <button @click="addActivity" class="text-indigo-600 text-sm font-medium">+ 新增活動</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    currentTab: 'time',
                    selectedPid: null,
                    projects: JSON.parse(localStorage.getItem('my-pm-tool')) || [
                        { id: 1, name: '年度研究案', contact: {name: '陳教授', info: 'ext 501'}, activities: [{name: '啟動會議', date: '2026-01-05'}] }
                    ]
                }
            },
            computed: {
                activeProject() {
                    return this.projects.find(p => p.id === this.selectedPid);
                },
                currentMonth() { return dayjs().month() + 1; },
                monthActivities() {
                    let list = [];
                    this.projects.forEach(p => {
                        p.activities.forEach(a => {
                            if (dayjs(a.date).month() + 1 === this.currentMonth) {
                                list.push({ ...a, pName: p.name });
                            }
                        });
                    });
                    return list.sort((a,b) => dayjs(a.date).diff(dayjs(b.date)));
                },
                weekActivities() {
                    const startOfWeek = dayjs().startOf('week');
                    const endOfWeek = dayjs().endOf('week');
                    let list = [];
                    this.projects.forEach(p => {
                        p.activities.forEach(a => {
                            const d = dayjs(a.date);
                            if (d >= startOfWeek && d <= endOfWeek) {
                                list.push({ ...a, pName: p.name });
                            }
                        });
                    });
                    return list;
                }
            },
            watch: {
                projects: {
                    handler(val) { localStorage.setItem('my-pm-tool', JSON.stringify(val)); },
                    deep: true
                }
            },
            methods: {
                dayjs,
                tabClass(active) {
                    return `pb-2 px-4 font-medium transition ${active ? 'border-b-2 border-indigo-500 text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`;
                },
                getYearPos(date) {
                    const start = dayjs('2026-01-01');
                    return (dayjs(date).diff(start, 'day') / 365) * 100;
                },
                addProject() {
                    const id = Date.now();
                    this.projects.push({ id, name: '新計畫', contact: {name: '', info: ''}, activities: [] });
                    this.selectedPid = id;
                },
                addActivity() {
                    this.activeProject.activities.push({ name: '新活動', date: dayjs().format('YYYY-MM-DD') });
                },
                deleteProject() {
                    if(confirm('確定刪除？')) {
                        this.projects = this.projects.filter(p => p.id !== this.selectedPid);
                        this.selectedPid = null;
                    }
                }
            },
            mounted() { if(this.projects.length) this.selectedPid = this.projects[0].id; }
        }).mount('#app')
    </script>
</body>
</html>
